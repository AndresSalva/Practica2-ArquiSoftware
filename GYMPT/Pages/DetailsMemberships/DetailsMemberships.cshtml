@page
@model GYMPT.Pages.DetailsMemberships.DetailsMembershipsModel
@{
    ViewData["Title"] = "Detalles de Membresías";
}

<div class="text-center">
    <h1 class="display-4">Detalles de Membresías</h1>
    <p class="lead text-muted">Administra qué disciplinas forman parte de cada membresía.</p>
</div>

<div class="d-flex justify-content-center my-4">
    <a class="btn btn-primary btn-lg shadow-sm" asp-page="/DetailsMemberships/DetailsMembershipCreate">
        <i class="fas fa-plus me-2"></i>Agregar disciplina a una membresía
    </a>
</div>

@if (!Model.MembershipDisciplineGroups.Any())
{
    <div class="alert alert-info shadow-sm text-center">
        Aún no se registraron disciplinas para ninguna membresía.
    </div>
}
else
{
    <div class="row row-cols-1 row-cols-md-2 g-4">
        @foreach (var group in Model.MembershipDisciplineGroups)
        {
            <div class="col">
                <div class="card h-100 shadow-sm">
                    <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                        <span class="fw-bold">@group.MembershipName</span>
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge bg-secondary">@group.Disciplines.Count @((group.Disciplines.Count == 1) ? "disciplina" : "disciplinas")</span>
                            <a class="btn btn-sm btn-outline-light" asp-page="/DetailsMemberships/DetailsMembershipEdit" asp-route-token="@Model.GetEncodedToken(group.MembershipId)" title="Editar disciplinas">
                                <i class="fas fa-sliders-h"></i>
                            </a>
                            <form method="post" asp-page-handler="DeleteMembership" asp-route-membershipId="@group.MembershipId" class="d-inline" onsubmit="confirmDeleteMembership(event, '@group.MembershipName');">
                                <button type="submit" class="btn btn-sm btn-outline-danger" title="Eliminar todas las disciplinas">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            @foreach (var discipline in group.Disciplines)
                            {
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span>@discipline.DisciplineName</span>
                                    <form method="post" asp-page-handler="Delete" asp-route-membershipId="@group.MembershipId" asp-route-disciplineId="@discipline.DisciplineId" class="d-inline" onsubmit="confirmDeleteDetail(event, '@group.MembershipName - @discipline.DisciplineName');">
                                        <button type="submit" class="btn btn-sm btn-outline-danger" title="Eliminar">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </form>
                                </li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        }
    </div>
}

@section Scripts {
    <script>
        function confirmDeleteDetail(event, detailName) {
            event.preventDefault();
            const form = event.target;
            Swal.fire({
                title: '¿Estás seguro?',
                text: `Se eliminará la relación ${detailName}. Esta acción no se puede deshacer.`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    form.submit();
                }
            });
        }

        function confirmDeleteMembership(event, membershipName) {
            event.preventDefault();
            const form = event.target;
            Swal.fire({
                title: '¿Eliminar todas las disciplinas?',
                text: `Se eliminarán todas las disciplinas asociadas a ${membershipName}. Esta acción no se puede deshacer.`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Sí, eliminar todo',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    form.submit();
                }
            });
        }
    </script>

    @if (TempData["SuccessMessage"] != null)
    {
        <script type="text/javascript">
            Swal.fire({
                title: '¡Éxito!',
                text: '@Html.Raw(TempData["SuccessMessage"])',
                icon: 'success',
                timer: 3000,
                showConfirmButton: false
            });
        </script>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <script type="text/javascript">
            Swal.fire({
                title: 'Error',
                text: '@Html.Raw(TempData["ErrorMessage"])',
                icon: 'error'
            });
        </script>
    }
}
